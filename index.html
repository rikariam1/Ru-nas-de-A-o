
<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta charset="UTF-8" />
  <title>Personagem com Firebase</title>
  <style>
    body {
      background-color: #191919;
      font-family: Arial, sans-serif;
      
    }
    .container {
      position: relative;
      width: 100%;
      height: 100%;
    }
    /* Oculta visualmente as barras de rolagem, mas mant√©m a rolagem ativa */
html, body {
  scrollbar-width: none; /* Firefox */
}

html::-webkit-scrollbar,
body::-webkit-scrollbar {
  display: none; /* Chrome, Edge, Safari, Opera */
}
/* Espa√ßamento padr√£o de linha */
[contenteditable="true"] {
  line-height: 1.4;
}

  .paragrafo {
    margin-top: 0px;
    margin-bottom: 16px;
  }

  .paragrafo .marcador {
    display: inline-block;
    vertical-align: top;
  }

  .paragrafo .subnivel {
    margin-left: 20px;
  }

  .paragrafo br {
    line-height: 1.2;
  }

    
.circulos-wrapper {
  position: absolute;
  width: 350px;
  height: 350px;
  margin: 0px auto; /* Centraliza na tela */
  left: 575px;
}

.circulo-principal {
  width: 350px;
  height: 350px;
  border: 6px solid white;
  border-radius: 50%;
  background-color: transparent;
  position: absolute;
  left: 0px;
  top: 0px;
  overflow: hidden;
  z-index: 1;
}

.circulo-principal img {
  width: 100%;
  height: 100%;
  object-fit: contain;
}

/* Pequenos */
.circulo-menor {
  width: 65px;
  height: 65px;
  border: 3px solid white;
  border-radius: 50%;
  background-color: #191919;
  position: absolute;
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 2;
}

.circulo-menor span {
  position: absolute;
  color: white;
  font-weight: bold;
  font-size: 15px;
  transform: translateY(110%);
}
.circulo-menor span::before {
  content: "";
  position: absolute;
  top: -3px;
  left: 50%;
  transform: translateX(-50%);
  width: 40px;
  height: 2px;
  background-color: white;
}
    .editavel {
      position: absolute;
      top: 4px;
      left: 50%;
      transform: translateX(-50%);
      color: white;
      font-size: 30px;
      font-weight: normal;
      text-align: center;
      outline: none;
      border: none;
      background: transparent;
      width: 60px;
    }

/* POSICIONAMENTO EM VOLTA DO C√çRCULO */
.centro {
  top: 92%;
  left: 50%;
  transform: translate(-50%);
}
.direita {
  top: 77%;
  left: 86%;
  transform: translate(-50%);
}
.direita-cima {
  top: 40%;
  left: 100%;
  transform: translate(-50%);
}
.esquerda {
  top: 77%;
  left: 14%;
  transform: translate(-50%);
}
.esquerda-cima {
  top: 40%;
  left: 0%;
  transform: translate(-50%);
}


    .barras-container {
      position: absolute; /* ou fixed, se quiser que fique fixo mesmo rolando */
      top: 425px;
      left: 600px;
      display: flex;
      flex-direction: column;
    }

    .bloco-barra {
      position: relative;
      width: 300px;
      margin-bottom: 20px;
    }
    .bar-title {
      color: #fff;
      font-weight: bold;
      font-size: 18px;
      text-align: center;
      margin-bottom: 5px;
    }
    .bar-container {
      width: 300px;
      height: 30px;
      background-color: #191919;
      border: 2px solid #fff;
      overflow: hidden;
      position: relative; /* mant√©m a estrutura */
    }
    /* Barras de vida, alma e sanidade */
    .bar, .negative-hp-bar {
      height: 100%;
      width: 0;
      transition: width 0.6s, background-color 0.3s;
    }
    /* Cores espec√≠ficas das barras */
    .bar.hp {
      background-color: rgb(182, 36, 36);
    }
    .bar.alma {
      background-color: rgb(45, 168, 255);
    }
    .bar.sanidade {
      background-color: rgb(103, 1, 171);
    }
    /* Barra negativa de HP (por tr√°s da barra principal) */
    .negative-hp-bar {
      background-color: black;
      position: absolute;
      top: 0;
      left: 0;
      z-index: 0;
    }
    /* Barra extra positiva (excesso) */
    .positive-bar {
      background-color: orange;
      position: absolute;
      top: 0;
      left: 0;
      height: 100%;
      width: 0;
      z-index: 1.5;
      pointer-events: none; /* n√£o interfere em cliques */
      transition: width 0.6s;
    }
    /* Input central dentro da barra */
    .bar-input {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 100px;
      border: none;
      background: none;
      color: #fff;
      font-weight: bold;
      text-align: center;
      z-index: 2;
      font-size: 16px;
      transition: opacity 1s;
    }
    /* Setas de controle das barras */
    .arrow {
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      color: #fff;
      cursor: pointer;
      z-index: 3;
      user-select: none;
    }
    .arrow.left-single {
      left: 30px;
      font-size: 28px;
    }
    .arrow.right-single {
      right: 30px;
      font-size: 28px;
    }
    .arrow.left-double {
      left: 5px;
      font-size: 28px;
    }
    .arrow.right-double {
      right: 5px;
      font-size: 28px;
    }
    /* Mensagem de "MORTO" */
    .dead-message {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      color: white;
      font-size: 18px;
      font-weight: bold;
      display: none;
      z-index: 4;
    }
    
    /* Input file escondido (upload customizado) */
    input[type="file"] {
      display: none;
    }
    /* Container de infos √† esquerda */
    .info-esquerda {
      position: absolute;
      left: 25px;
      top: 10px;
      display: flex;
      flex-direction: column;
      gap: 12px;
      color: white;
    }
    /* Linha dentro do container de infos */
    .info-linha {
  display: flex;
  flex-direction: row; /* linha */
  align-items: center;
  gap: 10px;
}

    /* Labels dentro das linhas */
    .info-linha label {
      min-width: 50px;
      font-weight: bold;
    }
    /* Classe extra pra margem em labels espec√≠ficas */
    .label-mov {
      margin-left: 10px;
    }
    /* Campos edit√°veis gerais */
    .campo-editavel {
      border: 1px solid white;
      padding: 5px 10px;
      color: white;
      background: transparent;
      width: 300px;
      height: 20px;
      outline: none;
      font-size: 15px;
      display: flex;
      align-items: center;
      justify-content: left;
      overflow: hidden;
      white-space: nowrap;
      text-overflow: ellipsis;
    }
    .campo-editavel-arq {
          border: 1px solid white;
      padding: 5px 10px;
      color: white;
      background: transparent;
      width: 255px;
      height: 20px;
      outline: none;
      font-size: 15px;
      display: flex;
      align-items: center;
      justify-content: left;
      overflow: hidden;
      white-space: nowrap;
      text-overflow: ellipsis;
    }
    /* Vers√£o pequena dos campos edit√°veis */
    .campo-editavel.pequeno {
      width: 50px;
      height: 20px;
      font-size: 25px;
      justify-content: center;
      font-weight: normal;
    }
    .habilidades-container {
      margin-top: 20px;
      position: absolute;
      top: 5%;
      left: 1100px;
      display: flex;
      flex-direction: column;
      gap: 10px;
      overflow-y: auto;
      scrollbar-width: none; 
    }
    .habilidades-linha {
      display: flex;
      align-items: center;
      gap: 10px;
      color: white;
      font-weight: bold;
      font-size: 20px;
    }
    .titulo-pericias {
  font-size: 18px;
  margin-top: 15px;
  text-align: center;
  font-weight: bold;
  color: white;
  text-transform: uppercase; /* opcional, deixa em mai√∫sculas */
  border-bottom: 2px solid white; /* linha decorativa opcional */
  padding-bottom: 4px;
  display: inline-block; /* permite limitar largura */
  width: 275px; /* largura da linha */
}

    .campo-editavel.grande {
      width: 370px;
      height: 80vh;
      border: 2px solid white;
      color: white;
      background-color: transparent;
      padding: 5px;
      overflow-y: auto;
      overflow-x: hidden;
      white-space: pre-wrap;
      word-break: break-word;
      overflow-wrap: break-word;
      text-align: left;
      line-height: 1.2;
      display: block; 
      overflow-y: auto;
      scrollbar-width: none; /* OU inline-block */
    }
    .container-pericias {
      position: absolute;
      top: 180px;  /* ajuste como quiser */
      left: 85px; /* ajuste como quiser */
      width: 320px;
      height: 585px;
      overflow-y: auto;
      scrollbar-width: none; 
    }
    .lista-pericias-completa {
      position: absolute;
      top: 45px;
      left: 0px;
      display: flex;
      flex-direction: column;
      gap: 2px;
      z-index: 2;
      color: white;
      font-size: 13px;
    }
    .linha-pericia {
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .linha-pericia.roxa .pericia,
    .linha-pericia.roxa .atributo {
      color: #ae48ee; /* roxo */
    }
    .pericia {
      width: 130px;
      text-align: left;
      font-weight: normal;
    }
    .atributo {
      width: 50px;
      text-align: left;
      font-weight: normal;
    }
    .campo-editavel-linha {
      border-bottom: 2px solid white;
      min-width: 80px;
      height: 20px;
      color: white;
      outline: none;
      background: transparent;
    }
    /* Container geral das resist√™ncias e vulnerabilidades */
    .resistencias-vulnerabilidades {
      position: absolute;
      top: 675px;
      left: 500px;
      display: flex;
      flex-direction: column;
      color: white;
      font-family: Arial, sans-serif;
    }
    /* Linha com uma resist√™ncia ou vulnerabilidade */
    .linha-rv {
      display: flex;
      align-items: center;
      gap: 10px;
    }
    /* Label da linha */
    .linha-rv label {
      min-width: 165px;
      font-weight: bold;
      font-size: 14px;
    } 
    /* Campo edit√°vel da linha */
    .campo-linha-rv {
      width: 300px; /* largura fixa */
      height: 20px;
      padding: 2px 4px;
      border-bottom: 2px solid white;
      outline: none;
      color: white;
      overflow: auto;
      text-overflow: ellipsis;
    }
    /* Container das abas */
    .abas {
      position: absolute;         /* Define que ser√° posicionado fora do fluxo normal */
      top: 0px;                    /* Posi√ß√£o vertical da aba na tela */
      left: 1020px;                  /* Posi√ß√£o horizontal */
      display: flex;           /* Deixa lado a lado */
      border-bottom: 2px solid #333;
      margin-bottom: 20px;
      font-size: 14px;
    }
    /* Cada aba individual */
    .aba {
      padding: 10px 20px;
      color: white;
      cursor: pointer;
      position: relative;
      font-weight: bold;
    }
    /* Linha roxa embaixo da aba ativa */
    .aba.ativa::after {
      content: "";
      position: absolute;
      bottom: -2px;
      left: 0;
      right: 0;
      height: 3px;
      background-color: purple;
      }
    /* Esconde os conte√∫dos que n√£o est√£o ativos */
    .conteudos .conteudo-aba {
      display: none;
    }
    .inventario-container {
      margin-top: 20px;
      position: absolute;
      top: 5%;
      left: 1100px;
      display: flex;
      flex-direction: column;
      gap: 10px;
      overflow-y: auto;
      scrollbar-width: none; 
    }
    .inventario-linha {
      display: flex;
      align-items: center;
      gap: 10px;
      color: white;
      font-weight: bold;
      font-size: 20px;
    }
    .inventario-titulo {
      font-size: 20px;
    }
    .idolos-container {
      margin-top: 20px;
      position: absolute;
      top: 5%;
      left: 1100px;
      display: flex;
      flex-direction: column;
      gap: 10px;
      overflow-y: auto;
      scrollbar-width: none; 
    }
    .notas-container {
      margin-top: 20px;
      position: absolute;
      top: 5%;
      left: 1100px;
      display: flex;
      flex-direction: column;
      gap: 10px;
      overflow-y: auto;
      scrollbar-width: none; 
    }
    @media screen and (max-width: 768px) {
  .container {
    display: flex;
    flex-direction: column;
    align-items: center;
    position: relative;
  }
  .circulos-wrapper {
    width: 75vw;  /* 90% da largura da tela */
    height: 75vw; /* mant√©m quadrado */
    position: absolute;
    left: 55px;
  }
  .circulo-principal {
    width: 100%;
    height: 100%;
    border-width: 4px; /* borda menor pra n√£o ficar pesado */
  }
  .circulo-menor {
    width: 16vw;   /* circulos menores tamb√©m redimensionam */
    height: 16vw;
    border-width: 2px;
  }
    .info-esquerda {
    position: absolute;
    top: 350px;
    left: 50%;
    transform: translate(-50%);
    width: 85%;
    height: auto;
  }
    .barras-container {
      position: absolute; /* ou fixed, se quiser que fique fixo mesmo rolando */
      top: 550px;
      left: 50%;
      transform: translate(-50%);
      display: flex;
      flex-direction: column;
    }
    .abas {
      position: absolute;
      top: 1575px;
      left: 50%;
      transform: translate(-50%);
      font-size: 13px;
    }
    .aba {
      padding: 8px;
    }
  .habilidades-container,
  .inventario-container,
  .idolos-container,
  .notas-container {
    position: absolute;
    top: 1595px;
    left: 48%;
    transform: translate(-50%);
    width: 90vw;
    margin-top: 20px;
  }

  .campo-editavel.grande {
    width: 100%;
    height: 600px;
    margin-bottom: 15px;
  }
     .campo-editavel-arq {
    width: 65%;
    height: 20px;
    margin-bottom: 15px;
    }

  .resistencias-vulnerabilidades {
    position: absolute;
    top: 800px;
    left: 50%;
    transform: translate(-50%);
    margin-top: 20px;
    width: 90%;
  }
  .linha-horizontal {
  position: absolute;
  top: 900px;
  width: 100%;
  height: 2px;
  background-color: white;
  margin: 20px 0; /* opcional, s√≥ pra dar respiro */
}
 .linha-horizontal-2 {
  position: absolute;
  top: 1550px;
  width: 100%;
  height: 2px;
  background-color: white;
  margin: 20px 0; /* opcional, s√≥ pra dar respiro */
}

  .container-pericias {
    position: absolute;
    top: 945px;
    left: 55%;
    transform: translate(-50%);
  }
  .lista-pericias-completa {
    font-size: 18px;
  }
}

  </style>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyB3g9cW1262DtgjD-t55iNCM2yYQf6ctTg",
      authDomain: "hp-bar-5337b.firebaseapp.com",
      databaseURL: "https://hp-bar-5337b-default-rtdb.firebaseio.com",
      projectId: "hp-bar-5337b",
      storageBucket: "hp-bar-5337b.appspot.com",
      messagingSenderId: "891062479752",
      appId: "1:891062479752:web:a94ee1b9ba5ddbb826683d",
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
  </script>
</head>
<body>

  <div class="circulos-wrapper">
    <div class="circulo-principal" onclick="document.getElementById('upload').click()">
      <img id="preview" src="" alt="">
    </div>
    <input type="file" id="upload" accept="image/*" onchange="handleImage(event)" />

    <div class="circulo-menor centro"><div class="editavel" contenteditable="true" id="edit-vig"></div><span>VIG</span></div>
    <div class="circulo-menor direita"><div class="editavel" contenteditable="true" id="edit-agi"></div><span>PRE</span></div>
    <div class="circulo-menor direita-cima"><div class="editavel" contenteditable="true" id="edit-for"></div><span>INT</span></div>
    <div class="circulo-menor esquerda"><div class="editavel" contenteditable="true" id="edit-pre"></div><span>AGI</span></div>
    <div class="circulo-menor esquerda-cima"><div class="editavel" contenteditable="true" id="edit-int"></div><span>FOR</span></div>
  </div>

  <div class="info-esquerda">
  <div class="info-linha">
    <label>NOME</label>
    <div class="campo-editavel" contenteditable="true" id="info-nome"></div>
  </div>
  <div class="info-linha">
    <label>RA√áA</label>
    <div class="campo-editavel" contenteditable="true" id="info-raca"></div>
  </div>
    <div class="info-linha">
    <label>ARQU√âTIPO</label>
    <div class="campo-editavel-arq" contenteditable="true" id="info-idade"></div>
  </div>
  <div class="info-linha">
    <label>LVL</label>
    <div class="campo-editavel pequeno" contenteditable="true" id="info-lvl"></div>
    <label class="label-mov">MOV</label>
    <div class="campo-editavel pequeno" contenteditable="true" id="info-mov"></div>
  </div>
</div>

  <!-- Barras -->
  <div class="barras-container">
  <div class="bloco-barra">
    <div class="bar-title vida">VIDA</div>
    <div class="bar-container">
      <div class="negative-hp-bar" id="negative-hp-bar"></div>
      <div class="positive-bar" id="hp-excesso"></div> <!-- excesso -->
      <div class="bar hp" id="hp-bar"></div>
      <div class="arrow left-single" onclick="changeHP(-1)">‚Äπ</div>
      <div class="arrow right-single" onclick="changeHP(1)">‚Ä∫</div>
      <div class="arrow left-double" onclick="changeHP(-5)">¬´</div>
      <div class="arrow right-double" onclick="changeHP(5)">¬ª</div>
      <input type="text" id="hp-input" class="bar-input" value="0/0" oninput="updateHP(this.value)" />
      <div class="dead-message" id="dead-message">MORTO</div>
    </div>
  </div>

  <div class="bloco-barra">
    <div class="bar-title alma">ALMA</div>
    <div class="bar-container">
      <div class="positive-bar" id="alma-excesso"></div> <!-- excesso -->
      <div class="bar alma" id="alma-bar"></div>
      <div class="arrow left-single" onclick="changeBar('alma', -1)">‚Äπ</div>
      <div class="arrow right-single" onclick="changeBar('alma', 1)">‚Ä∫</div>
      <div class="arrow left-double" onclick="changeBar('alma', -5)">¬´</div>
      <div class="arrow right-double" onclick="changeBar('alma', 5)">¬ª</div>
      <input type="text" id="alma-input" class="bar-input" value="0/0" oninput="updateBar('alma', this.value)" />
    </div>
  </div>

  <div class="bloco-barra">
    <div class="bar-title sanidade">DETERMINA√á√ÉO</div>
    <div class="bar-container">
      <div class="positive-bar" id="sanidade-excesso"></div> <!-- excesso -->
      <div class="bar sanidade" id="sanidade-bar"></div>
      <div class="arrow left-single" onclick="changeBar('sanidade', -1)">‚Äπ</div>
      <div class="arrow right-single" onclick="changeBar('sanidade', 1)">‚Ä∫</div>
      <div class="arrow left-double" onclick="changeBar('sanidade', -5)">¬´</div>
      <div class="arrow right-double" onclick="changeBar('sanidade', 5)">¬ª</div>
      <input type="text" id="sanidade-input" class="bar-input" value="0/0" oninput="updateBar('sanidade', this.value)" />
    </div>
  </div>
</div>


<div class="resistencias-vulnerabilidades">
  <div class="linha-rv">
    <label for="campo-resistencias">RESIST√äNCIAS</label>
    <div id="resistencias" class="campo-linha-rv" contenteditable="true"></div>
  </div>
  <div class="linha-rv">
    <label for="vulnerabilidades">VULNERABILIDADES</label>
    <div id="vulnerabilidades" class="campo-linha-rv" contenteditable="true"></div>
  </div>
  <div class="linha-rv">
    <label for="proficiencias">PROFICI√äNCIAS</label>
    <div id="proficiencias" class="campo-linha-rv" contenteditable="true"></div>
  </div>
</div>
<div class="linha-horizontal"></div>
<div class="linha-horizontal-2"></div>


<div class="container-pericias">
  <div class="titulo-pericias">PER√çCIAS</div>
  <div class="lista-pericias-completa">
    <div class="linha-pericia"><span class="pericia">Acrobacia</span><span class="atributo">(AGI)</span><div class="campo-editavel-linha" contenteditable="true" id="pericia-acrobacia"></div></div>
    <div class="linha-pericia"><span class="pericia">Atletismo</span><span class="atributo">(FOR)</span><div class="campo-editavel-linha" contenteditable="true" id="pericia-atletismo"></div></div>
    <div class="linha-pericia"><span class="pericia">Bloqueio</span><span class="atributo">(FOR)</span><div class="campo-editavel-linha" contenteditable="true" id="pericia-bloqueio"></div></div>
    <div class="linha-pericia"><span class="pericia">Canaliza√ß√£o</span><span class="atributo">(PRE)</span><div class="campo-editavel-linha" contenteditable="true" id="pericia-canalizacao"></div></div>
    <div class="linha-pericia"><span class="pericia">Combate</span><span class="atributo">(FOR)</span><div class="campo-editavel-linha" contenteditable="true" id="pericia-combate"></div></div>
    <div class="linha-pericia"><span class="pericia">Condu√ß√£o</span><span class="atributo">(AGI)</span><div class="campo-editavel-linha" contenteditable="true" id="pericia-conducao"></div></div>
    <div class="linha-pericia"><span class="pericia">Engana√ß√£o</span><span class="atributo">(PRE)</span><div class="campo-editavel-linha" contenteditable="true" id="pericia-enganacao"></div></div>
    <div class="linha-pericia"><span class="pericia">Esquiva</span><span class="atributo">(AGI)</span><div class="campo-editavel-linha" contenteditable="true" id="pericia-esquiva"></div></div>
    <div class="linha-pericia"><span class="pericia">Fortitude</span><span class="atributo">(VIG)</span><div class="campo-editavel-linha" contenteditable="true" id="pericia-fortitude"></div></div>
    <div class="linha-pericia"><span class="pericia">Furtividade</span><span class="atributo">(AGI)</span><div class="campo-editavel-linha" contenteditable="true" id="pericia-furtividade"></div></div>
    <div class="linha-pericia"><span class="pericia">Influ√™ncia</span><span class="atributo">(PRE)</span><div class="campo-editavel-linha" contenteditable="true" id="pericia-intimidacao"></div></div>
    <div class="linha-pericia"><span class="pericia">Iniciativa</span><span class="atributo">(AGI)</span><div class="campo-editavel-linha" contenteditable="true" id="pericia-iniciativa"></div></div>
    <div class="linha-pericia"><span class="pericia">Intui√ß√£o</span><span class="atributo">(PRE)</span><div class="campo-editavel-linha" contenteditable="true" id="pericia-intuicao"></div></div>
    <div class="linha-pericia"><span class="pericia">Investiga√ß√£o</span><span class="atributo">(INT)</span><div class="campo-editavel-linha" contenteditable="true" id="pericia-investigacao"></div></div>
    <div class="linha-pericia"><span class="pericia">Ladinagem</span><span class="atributo">(AGI)</span><div class="campo-editavel-linha" contenteditable="true" id="pericia-ladinagem"></div></div>
    <div class="linha-pericia"><span class="pericia">Medicina</span><span class="atributo">(INT)</span><div class="campo-editavel-linha" contenteditable="true" id="pericia-medicina"></div></div>
    <div class="linha-pericia"><span class="pericia">Of√≠cio</span><span class="atributo">(INT)</span><div class="campo-editavel-linha" contenteditable="true" id="pericia-oficio"></div></div>
    <div class="linha-pericia"><span class="pericia">Precis√£o</span><span class="atributo">(AGI)</span><div class="campo-editavel-linha" contenteditable="true" id="pericia-percepcao"></div></div>
    <div class="linha-pericia"><span class="pericia">Percep√ß√£o</span><span class="atributo">(PRE)</span><div class="campo-editavel-linha" contenteditable="true" id="pericia-precisao"></div></div>
    <div class="linha-pericia"><span class="pericia">Religi√£o</span><span class="atributo">(INT)</span><div class="campo-editavel-linha" contenteditable="true" id="pericia-religiao"></div></div>
    <div class="linha-pericia"><span class="pericia">Sobreviv√™ncia</span><span class="atributo">(INT)</span><div class="campo-editavel-linha" contenteditable="true" id="pericia-sobrevivencia"></div></div>
    <div class="linha-pericia"><span class="pericia">Tecnologia</span><span class="atributo">(INT)</span><div class="campo-editavel-linha" contenteditable="true" id="pericia-tecnologia"></div></div>
    <div class="linha-pericia"><span class="pericia">Vontade</span><span class="atributo">(PRE)</span><div class="campo-editavel-linha" contenteditable="true" id="pericia-vontade"></div></div>
  </div>
</div>

<div class="abas">
  <div class="aba ativa" onclick="trocarAba('habilidades')">HABILIDADES</div>
  <div class="aba" onclick="trocarAba('inventario')">INVENT√ÅRIO</div>
  <div class="aba" onclick="trocarAba('idolos')">√çDOLOS</div>
  <div class="aba" onclick="trocarAba('anotacoes')">ANOTA√á√ïES</div>
</div>

<div class="conteudos">
  <div class="conteudo-aba" id="habilidades" style="display: block;">
    <!-- Coloca o conte√∫do de HABILIDADES aqui -->
     <div class="habilidades-container">
  <div class="habilidades-linha">
    <span class="habilidades-titulo">PH</span>
    <div class="campo-editavel pequeno" contenteditable="true" id="info-ph">0/0</div>
        <span class="habilidades-titulo">FOCO</span>
    <div class="campo-editavel pequeno" contenteditable="true" id="info-foco">0/0</div>
  </div>
  <div class="campo-editavel grande" contenteditable="true" id="campo-habilidades"><br></div>
</div>

  </div>
  <div class="conteudo-aba" id="inventario">
    <!-- Conte√∫do do INVENT√ÅRIO -->
  <div class="inventario-container">
  <div class="inventario-linha">
    <span class="inventario-titulo">CARGA</span>
    <div class="campo-editavel pequeno" contenteditable="true" id="carga">0/0</div>
  </div>
  <div class="campo-editavel grande" contenteditable="true" id="itens"><br></div>
</div>

  </div>
  <div class="conteudo-aba" id="idolos">
    <!-- Conte√∫do de √çDOLOS -->
     <div class="idolos-container">
  <div class="campo-editavel grande" contenteditable="true" id="campo-idolos"><br></div>
</div>

  </div>
  <div class="conteudo-aba" id="anotacoes">
    <!-- Conte√∫do de ANOTA√á√ïES -->
    <div class="notas-container">
  <div class="campo-editavel grande" contenteditable="true" id="notas"><br></div>
  </div>
</div>


<script>
/* ==============================
   üîπ CONFIGURA√á√ÉO INICIAL
============================== */
const personagemId = new URLSearchParams(window.location.search).get("page");
if (!personagemId) {
  alert("Adicione ?page=nome na URL");
  throw new Error("Sem personagem");
}

/* ==============================
   üîπ FUN√á√ïES DE SALVAR E CARREGAR DADOS
============================== */
function salvarTexto(id) {
  const valor = document.getElementById(id).innerHTML;
  db.ref("texto/" + personagemId + "/" + id).set(valor);
}

function carregarDados() {
  // imagem
  db.ref("imagem/" + personagemId).once("value", snap => {
    if (snap.exists()) document.getElementById("preview").src = snap.val();
  });

  // textos comuns
  const camposTexto = [
    "edit-vig","edit-agi","edit-for","edit-pre","edit-int",
    "info-nome","info-idade","info-raca","info-lvl","info-mov",
    "info-ph","info-foco","campo-habilidades","carga","itens","campo-idolos",
    "notas","resistencias","vulnerabilidades","proficiencias"
  ];

  camposTexto.forEach(id => {
    db.ref("texto/" + personagemId + "/" + id).once("value", snap => {
      if (snap.exists()) document.getElementById(id).innerHTML = snap.val();
    });
    document.getElementById(id).addEventListener("input", () => salvarTexto(id));
  });

  // barras de HP / alma / sanidade
  ["hp", "alma", "sanidade"].forEach(tipo => {
    db.ref(`${tipo}/${personagemId}`).on("value", snap => {
      if (snap.val()) {
        document.getElementById(`${tipo}-input`).value = snap.val();
        tipo === "hp" ? updateHP(snap.val(), false) : updateBar(tipo, snap.val(), false);
      }
    });
  });
}

/* ==============================
   üîπ FUN√á√ÉO DE IMAGEM
============================== */
function handleImage(event) {
  const file = event.target.files[0];
  if (!file) return;

  const reader = new FileReader();
  reader.onload = e => {
    const base64 = e.target.result;
    document.getElementById('preview').src = base64;
    db.ref("imagem/" + personagemId).set(base64);
  };
  reader.readAsDataURL(file);
}

/* ==============================
   üîπ PER√çCIAS
============================== */
const idsPericias = [
  "pericia-acrobacia","pericia-atletismo","pericia-bloqueio","pericia-canalizacao","pericia-combate",
  "pericia-conducao","pericia-enganacao","pericia-esquiva","pericia-fortitude","pericia-furtividade",
  "pericia-iniciativa","pericia-intimidacao","pericia-intuicao","pericia-investigacao","pericia-medicina",
  "pericia-oficio","pericia-precisao","pericia-percepcao","pericia-religiao","pericia-sobrevivencia",
  "pericia-tecnologia","pericia-vontade","pericia-ladinagem"
];

function salvarPericia(id) {
  const valor = document.getElementById(id).innerText;
  db.ref("pericias/" + personagemId + "/" + id).set(valor);
}

function verificarCorPericia(id) {
  const el = document.getElementById(id);
  const linha = el.closest(".linha-pericia");
  if (!linha) return;

  const valor = el.innerText.trim();
  if (valor !== "") {
    linha.classList.add("roxa");
    db.ref("pericias/" + personagemId + "/" + id + "_cor").set(true);
  } else {
    linha.classList.remove("roxa");
    db.ref("pericias/" + personagemId + "/" + id + "_cor").remove();
  }
}

// Inicializa per√≠cias
idsPericias.forEach(id => {
  const el = document.getElementById(id);
  if (!el) return;

  db.ref("pericias/" + personagemId + "/" + id).once("value", snap => {
    if (snap.exists()) {
      el.innerText = snap.val();
      verificarCorPericia(id);
    }
  });

  db.ref("pericias/" + personagemId + "/" + id + "_cor").once("value", snap => {
    if (snap.exists()) el.closest(".linha-pericia").classList.add("roxa");
  });

  el.addEventListener("input", () => {
    salvarPericia(id);
    verificarCorPericia(id);
  });
});

/* ==============================
   üîπ BARRAS DE STATUS (HP, Alma, Sanidade)
============================== */
function updateHP(value, salvar = true) {
  // Extrai n√∫meros e o valor entre par√™nteses (vida tempor√°ria)
  const match = value.match(/^(-?\d+)\s*\/\s*(\d+)(?:\s*\((\-?\d+)\))?$/);
  if (!match) return;

  let current = parseInt(match[1]);
  let max = parseInt(match[2]);
  let extra = parseInt(match[3]) || 0;

  const bar = document.getElementById("hp-bar");
  const negative = document.getElementById("negative-hp-bar");
  const excesso = document.getElementById("hp-excesso");
  const input = document.getElementById("hp-input");
  const dead = document.getElementById("dead-message");

  if (max <= 0) return;

  if (salvar) db.ref("hp/" + personagemId).set(value);

  const maxNeg = Math.floor(max / 2);
  current = Math.max(current, -maxNeg);

  // porcentagem base (barra vermelha)
  const perc = (current / max) * 100;
  bar.style.width = Math.max(0, perc) + "%";

  // barra negativa (hp abaixo de 0)
  const negPerc = current < 0 ? Math.min(100, (-current / maxNeg) * 100) : 0;
  negative.style.width = negPerc + "%";

  // excesso padr√£o (ex: 12/10) + adicional entre par√™nteses (10/10 (2))
  let excPerc = 0;
  if (current > max) excPerc = ((current - max) / max) * 100;
  if (extra > 0) excPerc += (extra / max) * 100;
  excesso.style.width = Math.min(excPerc, 100) + "%";

  // Cores e estado
  if (current <= 0) {
    bar.style.backgroundColor = "black";
    dead.style.display = current <= -maxNeg ? "block" : "none";
    input.style.opacity = current <= -maxNeg ? "0" : "1";
  } else {
    bar.style.backgroundColor = perc > 50 ? "rgb(182,36,36)" : "rgb(121,26,26)";
    dead.style.display = "none";
    input.style.opacity = "1";
  }
}

/* ==============================
   üîπ OUTRAS BARRAS (Alma, Sanidade, etc)
============================== */
function updateBar(tipo, value, salvar = true) {
  const match = value.match(/^(\d+)\s*\/\s*(\d+)(?:\s*\((\d+)\))?$/);
  if (!match) return;

  let current = parseInt(match[1]);
  let max = parseInt(match[2]);
  let extra = parseInt(match[3]) || 0;

  const bar = document.getElementById(`${tipo}-bar`);
  const excesso = document.getElementById(`${tipo}-excesso`);

  if (max <= 0) return;

  if (salvar) db.ref(`${tipo}/${personagemId}`).set(value);

  const basePerc = Math.min(100, (current / max) * 100);
  let excessoPerc = 0;

  if (current > max) excessoPerc = ((current - max) / max) * 100;
  if (extra > 0) excessoPerc += (extra / max) * 100;

  bar.style.width = basePerc + "%";
  excesso.style.width = Math.min(excessoPerc, 100) + "%";
}

/* ==============================
   üîπ ALTERAR VALORES (Setas)
============================== */
function changeHP(amount) {
  const input = document.getElementById("hp-input");

  // Captura valores com regex (ex: 10/10 (2))
  const match = input.value.match(/^(-?\d+)\s*\/\s*(\d+)(?:\s*\((\-?\d+)\))?$/);
  if (!match) return;

  let current = parseInt(match[1]);
  const max = parseInt(match[2]);
  const extra = parseInt(match[3]) || 0;

  if (isNaN(current) || isNaN(max) || max <= 0) return;

  // Ajusta valor principal
  current = Math.max(Math.floor(-max / 2), current + amount);

  // Atualiza o campo mantendo o extra
  input.value = `${current}/${max}${extra ? ` (${extra})` : ""}`;

  updateHP(input.value);
}

function changeBar(tipo, amount) {
  const input = document.getElementById(`${tipo}-input`);

  // Captura valores com regex (ex: 10/10 (2))
  const match = input.value.match(/^(\d+)\s*\/\s*(\d+)(?:\s*\((\d+)\))?$/);
  if (!match) return;

  let current = parseInt(match[1]);
  const max = parseInt(match[2]);
  const extra = parseInt(match[3]) || 0;

  if (isNaN(current) || isNaN(max) || max <= 0) return;

  // Ajusta valor base
  current = Math.max(0, current + amount);

  // Atualiza mantendo o valor extra
  input.value = `${current}/${max}${extra ? ` (${extra})` : ""}`;

  updateBar(tipo, input.value);
}
/* ==============================
   üîπ ALTERAR VALORES (Setas)
============================== */
function changeHP(amount) {
  const input = document.getElementById("hp-input");

  // Captura valores com regex (ex: 10/10 (2))
  const match = input.value.match(/^(-?\d+)\s*\/\s*(\d+)(?:\s*\((\-?\d+)\))?$/);
  if (!match) return;

  let current = parseInt(match[1]);
  const max = parseInt(match[2]);
  let extra = parseInt(match[3]) || 0;

  if (isNaN(current) || isNaN(max) || max <= 0) return;

  if (amount < 0 && extra > 0) {
    // Diminui o extra primeiro
    extra += amount; // amount √© negativo
    if (extra < 0) {
      current += extra; // restante vai para o HP normal
      extra = 0;
    }
  } else {
    // Aumenta HP base ou extra
    current += amount;
  }

  // Garante que HP m√≠nimo n√£o quebre a barra
  const maxNeg = Math.floor(max / 2);
  current = Math.max(current, -maxNeg);

  // Atualiza o campo
  input.value = `${current}/${max}${extra > 0 ? ` (${extra})` : ""}`;

  updateHP(input.value);
}

function changeBar(tipo, amount) {
  const input = document.getElementById(`${tipo}-input`);

  // Captura valores com regex (ex: 10/10 (2))
  const match = input.value.match(/^(\d+)\s*\/\s*(\d+)(?:\s*\((\d+)\))?$/);
  if (!match) return;

  let current = parseInt(match[1]);
  const max = parseInt(match[2]);
  let extra = parseInt(match[3]) || 0;

  if (isNaN(current) || isNaN(max) || max <= 0) return;

  if (amount < 0 && extra > 0) {
    // Diminui o extra primeiro
    extra += amount; // amount √© negativo
    if (extra < 0) {
      current += extra; // restante vai para o valor base
      extra = 0;
    }
  } else {
    current += amount;
  }

  current = Math.max(0, current);

  // Atualiza mantendo o valor extra
  input.value = `${current}/${max}${extra > 0 ? ` (${extra})` : ""}`;

  updateBar(tipo, input.value);
}

function habilitarMarcadores(containerId) {
  const container = document.getElementById(containerId);

  container.addEventListener("beforeinput", function (e) {
    if (e.inputType !== "insertText" || e.data !== " ") return;

    const sel = window.getSelection();
    if (!sel || sel.rangeCount === 0) return;

    const range = sel.getRangeAt(0);
    const bloco = getBlocoAtual(range, container);
    if (!bloco) return;

    const textoAntes = getTextoAntesDoCursor(bloco, range);

    // Subn√≠vel (  - )
    if (/^\s{2,}-\s*$/.test(textoAntes)) {
      e.preventDefault();
      limparTextoAntes(range);
      aplicarMarcador(bloco, "‚óã", true);
      return;
    }

    // Marcador normal ( - )
    if (/^\s*-\s*$/.test(textoAntes)) {
      e.preventDefault();
      limparTextoAntes(range);
      aplicarMarcador(bloco, "‚Ä¢");
    }
  });

  function aplicarMarcador(bloco, simbolo, subnivel = false) {
    // remove marcador antigo se existir
    const antigo = bloco.querySelector(".marcador");
    if (antigo) antigo.remove();

    const marcador = document.createElement("span");
    marcador.className = "marcador";
    marcador.textContent = simbolo + " ";
    marcador.contentEditable = "false";
    marcador.style.userSelect = "none";
    marcador.style.fontSize = subnivel ? "1.3em" : "2em";
    marcador.style.lineHeight = "0.8em";
    marcador.style.verticalAlign = "middle";
    if (subnivel) marcador.style.marginLeft = "20px";

    const zwsp = document.createTextNode("\u200B");
    bloco.insertBefore(marcador, bloco.firstChild);
    bloco.insertBefore(zwsp, marcador.nextSibling);

    // coloca cursor depois do marcador
    const sel = window.getSelection();
    const r = document.createRange();
    r.setStart(zwsp, 1);
    r.collapse(true);
    sel.removeAllRanges();
    sel.addRange(r);
  }

  function limparTextoAntes(range) {
    if (range.startContainer.nodeType === 3) {
      range.startContainer.textContent =
        range.startContainer.textContent.slice(range.startOffset);
    }
  }

  function getTextoAntesDoCursor(bloco, range) {
    let texto = "";
    const walker = document.createTreeWalker(bloco, NodeFilter.SHOW_TEXT, null);
    while (walker.nextNode()) {
      const node = walker.currentNode;
      if (node === range.startContainer) {
        texto += node.textContent.slice(0, range.startOffset);
        break;
      } else {
        texto += node.textContent;
      }
    }
    return texto.replace(/\u200B/g, "");
  }

  function getBlocoAtual(range, container) {
    // Se o cursor estiver diretamente no container, retorna ele
    let node = range.startContainer;
    while (node && node !== container) {
      if (node.nodeType === 1) return node;
      node = node.parentNode;
    }
    return container; // retorna container como fallback
  }
}

// aplica em todos os containers
["campo-habilidades", "itens", "campo-idolos", "notas"].forEach(habilitarMarcadores);



/* ==============================
   üîπ LINHA DIVIS√ìRIA (Ctrl + -)
============================== */
document.addEventListener('keydown', function(e) {
  if (e.ctrlKey && e.key === '-') {
    e.preventDefault();

    const sel = window.getSelection();
    if (!sel.rangeCount) return;

    const range = sel.getRangeAt(0);
    const campo = range.startContainer.closest('[contenteditable="true"]');

    // Apenas campos espec√≠ficos
    const camposPermitidos = ["campo-habilidades", "notas", "itens", "campo-idolos"];
    if (!campo || !camposPermitidos.includes(campo.id)) return;

    // cria a linha branca
    const linha = document.createElement('hr');
    linha.classList.add('linha-divisoria');
    linha.style.border = 'none';
    linha.style.borderTop = '2px solid white';
    linha.style.margin = '10px 0';
    linha.style.width = '100%';

    // insere onde o cursor est√°
    range.insertNode(linha);

    // move o cursor depois da linha
    range.setStartAfter(linha);
    range.collapse(true);
    sel.removeAllRanges();
    sel.addRange(range);

    // salva o campo
    salvarTexto(campo.id);
  }
});

// aplica nos campos desejados
["campo-habilidades", "itens", "campo-idolos"].forEach(habilitarMarcadores);

/* ==============================
   üîπ TROCA DE ABAS
============================== */
function trocarAba(abaId) {
  document.querySelectorAll(".aba").forEach(el => el.classList.remove("ativa"));
  document.querySelectorAll(".conteudo-aba").forEach(el => el.style.display = "none");
  document.querySelector(`.aba[onclick*="${abaId}"]`).classList.add("ativa");
  document.getElementById(abaId).style.display = "block";
}

/* ==============================
   üîπ EXECU√á√ÉO
============================== */
document.addEventListener("DOMContentLoaded", carregarDados);
document.addEventListener("paste", function (e) {
  const target = e.target;

  if (target.isContentEditable) {
    e.preventDefault();
    const text = (e.clipboardData || window.clipboardData).getData("text/plain");
    document.execCommand("insertText", false, text);
  }
});
// Containers que devem usar par√°grafos
const containers = ["campo-habilidades", "itens", "campo-idolos", "notas"];

containers.forEach(id => {
  const campo = document.getElementById(id);

  // Quando o campo ganhar foco, transforma qualquer texto solto em par√°grafos
  campo.addEventListener("focus", () => {
    transformarEmParagrafos(campo);
  });

  // Quando o usu√°rio digitar ou colar
  campo.addEventListener("input", () => {
    transformarEmParagrafos(campo);
  });
});

// Fun√ß√£o que envolve tudo em div.paragrafo
function transformarEmParagrafos(campo) {
  const nodes = Array.from(campo.childNodes);

  nodes.forEach(node => {
    // Se j√° for par√°grafo, ignora
    if (node.nodeType === 1 && node.classList.contains("paragrafo")) return;

    // Se for texto, cria par√°grafo
    if (node.nodeType === 3 || (node.nodeType === 1 && node.tagName !== "DIV")) {
      const p = document.createElement("div");
      p.className = "paragrafo";
      p.innerHTML = node.textContent || node.innerHTML;
      campo.replaceChild(p, node);
    }
  });
}


</script>




